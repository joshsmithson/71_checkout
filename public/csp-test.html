<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Content Security Policy Test</title>
  <style>
    body {
      font-family: 'Roboto', sans-serif;
      background-color: #121212;
      color: white;
      margin: 0;
      padding: 20px;
      line-height: 1.6;
    }
    .container {
      max-width: 800px;
      margin: 0 auto;
      background: #1E1E1E;
      padding: 20px;
      border-radius: 8px;
    }
    h1 {
      color: #E53935;
    }
    pre {
      background: #333;
      padding: 15px;
      border-radius: 4px;
      overflow-x: auto;
      white-space: pre-wrap;
    }
    .button {
      background: #E53935;
      color: white;
      border: none;
      padding: 10px 15px;
      border-radius: 24px;
      cursor: pointer;
      margin-top: 10px;
      font-size: 16px;
    }
    .success {
      background: #1e4020;
      border-left: 4px solid #43A047;
      padding: 10px;
      margin: 10px 0;
    }
    .error {
      background: #401e1e;
      border-left: 4px solid #E53935;
      padding: 10px;
      margin: 10px 0;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Content Security Policy Test</h1>
    <p>This page tests if there are Content Security Policy (CSP) issues affecting your deployment.</p>
    
    <h2>Browser Information</h2>
    <pre id="browser-info">Loading...</pre>
    
    <h2>Dynamic Script Execution Test</h2>
    <div id="script-test">Testing...</div>
    
    <h2>Inline Script Execution Test</h2>
    <div id="inline-test">Testing...</div>
    
    <h2>Fetch API Test</h2>
    <div id="fetch-test">Testing...</div>
    
    <h2>Environment Variable Access Test</h2>
    <div id="env-test">Testing...</div>
    
    <h2>React Initialization Test</h2>
    <div id="react-test">Testing...</div>
    
    <button id="run-tests" class="button">Run Tests Again</button>
    <button id="go-home" class="button" style="margin-left: 10px;">Return to App</button>
  </div>

  <script>
    // Utility function to update test results
    function updateTest(id, message, isSuccess) {
      const el = document.getElementById(id);
      if (el) {
        el.className = isSuccess ? 'success' : 'error';
        el.textContent = message;
      }
    }
    
    // Show browser information
    function showBrowserInfo() {
      const browserInfo = document.getElementById('browser-info');
      if (browserInfo) {
        browserInfo.textContent = JSON.stringify({
          userAgent: navigator.userAgent,
          href: window.location.href,
          protocol: window.location.protocol,
          host: window.location.host,
          timestamp: new Date().toISOString()
        }, null, 2);
      }
    }
    
    // Test dynamic script execution
    function testDynamicScript() {
      try {
        const script = document.createElement('script');
        script.textContent = 'window._dynamicScriptTest = true;';
        document.body.appendChild(script);
        
        setTimeout(() => {
          if (window._dynamicScriptTest === true) {
            updateTest('script-test', 'SUCCESS: Dynamic script executed correctly', true);
          } else {
            updateTest('script-test', 'ERROR: Dynamic script did not execute', false);
          }
        }, 100);
      } catch (error) {
        updateTest('script-test', `ERROR: ${error.message}`, false);
      }
    }
    
    // Test inline script execution
    function testInlineScript() {
      try {
        const testObj = { test: 'inline script executed' };
        updateTest('inline-test', 'SUCCESS: Inline script is working', true);
      } catch (error) {
        updateTest('inline-test', `ERROR: ${error.message}`, false);
      }
    }
    
    // Test fetch API
    function testFetch() {
      fetch('/')
        .then(response => {
          updateTest('fetch-test', 'SUCCESS: Fetch API is working', true);
        })
        .catch(error => {
          updateTest('fetch-test', `ERROR: ${error.message}`, false);
        });
    }
    
    // Test environment variables
    function testEnv() {
      try {
        const hasWindow = typeof window !== 'undefined';
        const hasProcess = typeof process !== 'undefined';
        const hasImportMeta = typeof import !== 'undefined';
        
        updateTest('env-test', `Available globals: window=${hasWindow}, process=${hasProcess}, import.meta=${hasImportMeta}`, true);
      } catch (error) {
        updateTest('env-test', `ERROR: ${error.message}`, false);
      }
    }
    
    // Test React initialization
    function testReact() {
      try {
        // Try loading React - this will only work if it's in the global scope
        // This is just a test to see if React is globally available (it shouldn't be)
        const hasReact = typeof React !== 'undefined';
        const hasReactDOM = typeof ReactDOM !== 'undefined';
        
        if (hasReact || hasReactDOM) {
          updateTest('react-test', `React is globally available, which is unusual`, true);
        } else {
          updateTest('react-test', `React is not globally available (expected behavior)`, true);
          
          // Try dynamic import (this may not work in older browsers)
          if (typeof window.importScripts === 'function') {
            updateTest('react-test', `Attempting to import React dynamically...`, true);
          } else {
            updateTest('react-test', `Dynamic import not available in this browser`, false);
          }
        }
      } catch (error) {
        updateTest('react-test', `ERROR: ${error.message}`, false);
      }
    }
    
    // Run all tests
    function runTests() {
      showBrowserInfo();
      testDynamicScript();
      testInlineScript();
      testFetch();
      testEnv();
      testReact();
    }
    
    // Initialize
    document.getElementById('run-tests').addEventListener('click', runTests);
    document.getElementById('go-home').addEventListener('click', function() {
      window.location.href = '/';
    });
    
    // Run tests on page load
    runTests();
  </script>
</body>
</html> 